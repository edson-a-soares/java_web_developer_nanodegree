pipeline {

    agent any

    environment {
        PROJECT_REPOSITORY_DIRECTORY = "eCommerce"
        APPLICATION_CONTEXT = "$WORKSPACE/$PROJECT_REPOSITORY_DIRECTORY"
    }

    options {
        skipDefaultCheckout()
        skipStagesAfterUnstable()
    }

    stages {

        stage ('SCM Checkout') {

            steps {
                checkout scm
            }

        }

        stage ('Build') {

            when {
                allOf {
                    changeset "$APPLICATION_CONTEXT/**"
                }
            }

            steps {

                script {
                    docker.image("maven:3.6.3-openjdk-8-slim").inside() {
                        sh 'cd $APPLICATION_CONTEXT && mvn -B -DskipTests clean package'
                    }
                }

            }

        }

        stage ('Test') {

            when {
                anyOf {
                    changeset "$APPLICATION_CONTEXT/**/*.java"
                }
            }

            steps {

                script {
                    docker.image("maven:3.6.3-openjdk-8-slim").inside() {
                        sh 'cd $APPLICATION_CONTEXT && mvn test'
                    }
                }

            }

        }

        stage ('Deploy') {

            steps {
                script {
                    sh 'echo $APPLICATION_CONTEXT'
                }
            }

        }

    }   // Stages

}       // Pipeline
